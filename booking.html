<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Κράτηση Ραντεβού — NR40</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- Stripe.js — loaded early -->
  <script src="https://js.stripe.com/v3/"></script>
  <script>window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };</script>
  <script defer src="/_vercel/insights/script.js"></script>
  <style>
    .piercing-only { display: none; }
    .piercing-only.visible { display: block; }

    /* ── Calendly embed ── */
    .cal-embed-wrap {
      border: 1px solid var(--border);
      background: var(--dark);
      margin-top: 8px;
      overflow: hidden;
    }
    .cal-embed-wrap iframe {
      width: 100%;
      height: 700px;
      border: none;
      display: block;
    }

    /* ── Piercing deposit info strip ── */
    .deposit-notice {
      background: rgba(201,168,76,0.08);
      border: 1px solid rgba(201,168,76,0.3);
      padding: 20px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      margin-top: 8px;
    }
    .deposit-notice-icon { font-size: 1.4rem; color: var(--gold); flex-shrink: 0; }
    .deposit-notice p {
      font-family: 'Space Mono', monospace;
      font-size: 0.62rem;
      letter-spacing: 0.08em;
      color: var(--gray-light);
      line-height: 1.7;
      text-transform: uppercase;
    }
    .deposit-notice strong { color: var(--gold); }

    /* ── Stripe Payment Element section ── */
    .stripe-payment-section {
      display: none;
      background: var(--card);
      border: 1px solid var(--gold);
      padding: 36px;
      margin-top: 24px;
    }
    .stripe-payment-section.visible { display: block; }
    .stripe-section-title {
      font-family: 'Unbounded', sans-serif;
      font-size: 0.88rem;
      letter-spacing: 0.08em;
      color: var(--gold);
      margin-bottom: 8px;
      text-transform: uppercase;
    }
    .stripe-section-sub {
      font-family: 'Space Mono', monospace;
      font-size: 0.58rem;
      letter-spacing: 0.1em;
      color: var(--gray);
      text-transform: uppercase;
      margin-bottom: 28px;
    }
    #payment-element {
      margin-bottom: 24px;
    }
    #stripe-pay-btn {
      width: 100%;
      font-family: 'Space Mono', monospace;
      font-size: 0.78rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      background: var(--gold);
      color: var(--black);
      border: none;
      padding: 20px;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.2s;
      position: relative;
    }
    #stripe-pay-btn:hover:not(:disabled) { background: var(--gold-light); }
    #stripe-pay-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    #stripe-pay-btn .btn-text { display: block; }
    #stripe-pay-btn .btn-spinner {
      display: none;
      width: 16px; height: 16px;
      border: 2px solid rgba(0,0,0,0.3);
      border-top-color: var(--black);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto;
    }
    #stripe-pay-btn.loading .btn-text { display: none; }
    #stripe-pay-btn.loading .btn-spinner { display: block; }
    #stripe-error {
      color: var(--red);
      font-family: 'Space Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 0.08em;
      margin-top: 12px;
      min-height: 18px;
    }

    /* ── Success block (shown after payment + booking) ── */
    .booking-success {
      display: none;
      background: rgba(39,174,96,0.08);
      border: 1px solid var(--green);
      padding: 40px;
      text-align: center;
      margin-top: 24px;
    }
    .booking-success.visible { display: block; }
    .booking-success h3 {
      font-family: 'Unbounded', sans-serif;
      font-size: 0.9rem;
      letter-spacing: 0.08em;
      color: var(--green);
      margin-bottom: 12px;
    }
    .booking-success p { color: var(--gray-light); font-style: italic; font-size: 1rem; }

    .form-input.invalid { border-color: var(--red) !important; }
    .form-input.valid { border-color: rgba(39,174,96,0.5) !important; }
  </style>
</head>
<body>

<nav id="navbar">
  <a href="index.html" class="nav-logo">
    <img src="nr40-logo.png" alt="NR40 Urban Arts" class="nav-logo-img">
  </a>
  <ul class="nav-links">
    <li><a href="index.html" data-gr="Αρχική" data-en="Home">Αρχική</a></li>
    <li><a href="team.html" data-gr="Καλλιτέχνες" data-en="Artists">Καλλιτέχνες</a></li>
    <li><a href="booking.html" data-gr="Κράτηση" data-en="Booking">Κράτηση</a></li>
    <li><a href="contact.html" data-gr="Επικοινωνία" data-en="Contact">Επικοινωνία</a></li>
  </ul>
  <div class="nav-right">
    <button class="lang-btn" id="langBtn">EN</button>
    <a href="booking.html" class="nav-cta-btn" data-gr="Κλείσε Ραντεβού" data-en="Book Now">Κλείσε Ραντεβού</a>
  </div>
  <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
</nav>
<div class="mobile-menu" id="mobileMenu">
  <a href="index.html" data-gr="Αρχική" data-en="Home">Αρχική</a>
  <a href="team.html" data-gr="Καλλιτέχνες" data-en="Artists">Καλλιτέχνες</a>
  <a href="booking.html" data-gr="Κράτηση" data-en="Booking">Κράτηση</a>
  <a href="contact.html" data-gr="Επικοινωνία" data-en="Contact">Επικοινωνία</a>
  <button class="mobile-lang" id="mobileLangBtn">EN</button>
</div>

<header class="page-header" data-title="BOOKING">
  <div class="container">
    <span class="label" data-gr="Κράτηση Ραντεβού" data-en="Book an Appointment">Κράτηση Ραντεβού</span>
    <h1 class="heading" style="font-size:clamp(2.2rem,5vw,4rem);margin-bottom:20px;" data-gr="Κλείσε <em>Ραντεβού</em>" data-en="Book <em>Now</em>">Κλείσε <em>Ραντεβού</em></h1>
    <div class="gold-rule"></div>
    <p style="color:var(--gray-light);font-style:italic;max-width:480px;" data-gr="Συμπλήρωσε τη φόρμα και θα επικοινωνήσουμε μαζί σου εντός 24 ωρών." data-en="Fill in the form and we will contact you within 24 hours to confirm.">Συμπλήρωσε τη φόρμα και θα επικοινωνήσουμε εντός 24 ωρών.</p>
  </div>
</header>

<div class="container">
  <div class="split-layout">
    <div class="form-wrap">
      <form id="bookingForm" novalidate>

        <div class="form-grid-2">
          <div class="form-group">
            <label class="form-label" for="fullName" data-gr="Ονοματεπώνυμο *" data-en="Full Name *">Ονοματεπώνυμο *</label>
            <input class="form-input" type="text" id="fullName" name="fullName" required
              data-ph-gr="π.χ. Νίκος Παπαδόπουλος" data-ph-en="e.g. Nikos Papadopoulos"
              placeholder="π.χ. Νίκος Παπαδόπουλος">
          </div>
          <div class="form-group">
            <label class="form-label" for="phone" data-gr="Τηλέφωνο *" data-en="Phone *">Τηλέφωνο *</label>
            <input class="form-input" type="tel" id="phone" name="phone" required
              inputmode="tel" autocomplete="tel"
              data-ph-gr="π.χ. 6912345678" data-ph-en="e.g. +30 6912345678"
              placeholder="π.χ. 6912345678">
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" for="email" data-gr="Email *" data-en="Email *">Email *</label>
          <input class="form-input" type="email" id="email" name="email" required
            placeholder="your@email.com" inputmode="email" autocomplete="email">
        </div>

        <div class="form-grid-2">
          <div class="form-group">
            <label class="form-label" for="service" data-gr="Υπηρεσία *" data-en="Service *">Υπηρεσία *</label>
            <select class="form-select" id="service" name="service" required>
              <option value="" disabled selected data-gr="Επέλεξε υπηρεσία" data-en="Select service">Επέλεξε υπηρεσία</option>
              <option data-gr="Νέο Τατουάζ" data-en="New Tattoo">Νέο Τατουάζ</option>
              <option data-gr="Cover-Up" data-en="Cover-Up">Cover-Up</option>
              <option data-gr="Touch-Up / Retouching" data-en="Touch-Up / Retouching">Touch-Up / Retouching</option>
              <option data-gr="Fine Line" data-en="Fine Line">Fine Line</option>
              <option data-gr="Traditional" data-en="Traditional">Traditional</option>
              <option data-gr="Realism" data-en="Realism">Realism</option>
              <option data-gr="Neo-Traditional" data-en="Neo-Traditional">Neo-Traditional</option>
              <option data-gr="Geometric / Mandala" data-en="Geometric / Mandala">Geometric / Mandala</option>
              <option data-gr="Watercolor" data-en="Watercolor">Watercolor</option>
              <option data-gr="Blackwork" data-en="Blackwork">Blackwork</option>
              <option data-gr="Japanese / Irezumi" data-en="Japanese / Irezumi">Japanese / Irezumi</option>
              <option data-gr="Portrait" data-en="Portrait">Portrait</option>
              <option data-gr="Sleeve" data-en="Sleeve">Sleeve</option>
              <option data-gr="Lettering / Calligraphy" data-en="Lettering / Calligraphy">Lettering / Calligraphy</option>
              <option value="Piercing" data-gr="Piercing" data-en="Piercing">Piercing</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="artist" data-gr="Καλλιτέχνης *" data-en="Artist *">Καλλιτέχνης *</label>
            <select class="form-select" id="artist" name="artist" required>
              <option value="" disabled selected data-gr="Επέλεξε καλλιτέχνη" data-en="Select artist">Επέλεξε καλλιτέχνη</option>
              <option value="Quipster">Quipster</option>
              <option value="Valia">Valia</option>
              <option value="Storm">Storm</option>
              <option value="Alex">Alex</option>
              <option value="Jimmy">Jimmy</option>
              <option value="Konstantinos">Konstantinos</option>
              <option value="Lacrimost">Lacrimost</option>
              <option data-gr="Όποιον θέλετε" data-en="Any available">Όποιον θέλετε</option>
            </select>
          </div>
        </div>

        <!-- PIERCING: Type -->
        <div class="form-group piercing-only" id="piercingTypeGroup">
          <label class="form-label" for="piercingType" data-gr="Τύπος Piercing *" data-en="Piercing Type *">Τύπος Piercing *</label>
          <select class="form-select" id="piercingType" name="piercingType">
            <option value="" disabled selected data-gr="Επέλεξε τύπο" data-en="Select type">Επέλεξε τύπο</option>
            <option value="Tooth Gem">Tooth Gem</option>
            <option value="Ear - Lobe" data-gr="Αυτί — Λοβός" data-en="Ear — Lobe">Αυτί — Λοβός</option>
            <option value="Ear - Helix" data-gr="Αυτί — Helix" data-en="Ear — Helix">Αυτί — Helix</option>
            <option value="Ear - Tragus" data-gr="Αυτί — Tragus" data-en="Ear — Tragus">Αυτί — Tragus</option>
            <option value="Ear - Daith" data-gr="Αυτί — Daith" data-en="Ear — Daith">Αυτί — Daith</option>
            <option value="Nose - Nostril" data-gr="Μύτη — Nostril" data-en="Nose — Nostril">Μύτη — Nostril</option>
            <option value="Nose - Septum" data-gr="Μύτη — Septum" data-en="Nose — Septum">Μύτη — Septum</option>
            <option value="Eyebrow" data-gr="Φρύδι" data-en="Eyebrow">Φρύδι</option>
            <option value="Lip" data-gr="Χείλος" data-en="Lip">Χείλος</option>
            <option value="Belly Button" data-gr="Αφαλός" data-en="Belly Button">Αφαλός</option>
            <option value="Other" data-gr="Άλλο" data-en="Other">Άλλο</option>
          </select>
        </div>

        <!-- PIERCING: Calendly date picker -->
        <div class="form-group piercing-only" id="calBookingGroup">
          <label class="form-label" data-gr="Επέλεξε Ημερομηνία & Ώρα *" data-en="Select Date & Time *">Επέλεξε Ημερομηνία & Ώρα *</label>
          <div class="cal-embed-wrap">
            <!--
              ════ CALENDLY SETUP (one time, Storm does this) ════
              1. Storm creates free account at https://calendly.com
              2. Connect Google Calendar:
                 Account Settings → Calendar Connections → Add Google Calendar
                 Calendly will auto-block times when Storm has other events.
              3. Create event type "Piercing Appointment" (30 or 60 min)
              4. Copy his Calendly username (shown in his profile URL)
              5. Replace STORM_CALENDLY_USERNAME below with that username
              6. Replace piercing-appointment with the event slug if different
              ════════════════════════════════════════════════════
            -->
            <iframe
              src="https://calendly.com/STORM_CALENDLY_USERNAME/piercing-appointment?background_color=0f0f0f&text_color=f0ece4&primary_color=c9a84c&hide_event_type_details=1&hide_gdpr_banner=1"
              id="calendlyIframe"
              title="Book piercing appointment with Storm"
              loading="lazy">
            </iframe>
          </div>
          <p class="form-hint" data-gr="Επέλεξε διαθέσιμη ημερομηνία και ώρα από το ημερολόγιο του Storm." data-en="Select an available date and time from Storm's calendar.">Επέλεξε διαθέσιμη ημερομηνία και ώρα από το ημερολόγιο του Storm.</p>
        </div>

        <!-- PIERCING: Deposit notice (informational — payment happens after submit) -->
        <div class="form-group piercing-only" id="depositNoticeGroup">
          <label class="form-label" data-gr="Προκαταβολή Piercing" data-en="Piercing Deposit">Προκαταβολή Piercing</label>
          <div class="deposit-notice">
            <div class="deposit-notice-icon">◈</div>
            <p data-gr="Απαιτείται προκαταβολή <strong>€12</strong> με κάρτα. Θα εισαχθεί μετά την υποβολή της φόρμας." data-en="A <strong>€12</strong> card deposit is required. You will be prompted to pay after submitting the form.">Απαιτείται προκαταβολή <strong>€12</strong> με κάρτα. Θα εισαχθεί μετά την υποβολή της φόρμας.</p>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label" data-gr="Φωτογραφίες / Σχέδια" data-en="Photos / Designs">
            Φωτογραφίες / Σχέδια
            <span style="color:var(--gray);font-size:0.85em;" data-gr="(έως 5 αρχεία · JPG, PNG, PDF)" data-en="(max 5 files · JPG, PNG, PDF)">(έως 5 αρχεία · JPG, PNG, PDF)</span>
          </label>
          <div class="file-upload" onclick="document.getElementById('fileInput').click()">
            <input type="file" id="fileInput" accept=".jpg,.jpeg,.png,.pdf" multiple>
            <span class="file-upload-icon">⊕</span>
            <span class="file-upload-text" data-gr="Κλικ για επιλογή αρχείων" data-en="Click to select files">Κλικ για επιλογή αρχείων</span>
          </div>
          <div class="file-list" id="fileList"></div>
        </div>

        <div class="form-group">
          <label class="form-label" for="message" data-gr="Μήνυμα" data-en="Message">Μήνυμα</label>
          <textarea class="form-textarea" id="message" name="message"
            data-ph-gr="Περιέγραψε την ιδέα σου, μέγεθος, τοποθεσία στο σώμα κ.λπ."
            data-ph-en="Describe your idea, size, body placement, etc."
            placeholder="Περιέγραψε την ιδέα σου, μέγεθος, τοποθεσία στο σώμα κ.λπ."></textarea>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
          <span class="btn-text" data-gr="Αποστολή" data-en="Send Request">Αποστολή</span>
          <span class="btn-spinner"></span>
        </button>

        <div class="alert" id="formAlert"></div>

      </form>

      <!--
        ═══════════════════════════════════════════════
        STRIPE PAYMENT ELEMENT — appears after form submit (piercing only)
        Inline card payment. No redirect. No external tab.
        ═══════════════════════════════════════════════
      -->
      <div class="stripe-payment-section" id="stripePaymentSection">
        <div class="stripe-section-title" data-gr="Πληρωμή Προκαταβολής" data-en="Pay Deposit">Πληρωμή Προκαταβολής</div>
        <div class="stripe-section-sub" data-gr="Ασφαλής πληρωμή €12 με κάρτα — powered by Stripe" data-en="Secure €12 card payment — powered by Stripe">Ασφαλής πληρωμή €12 με κάρτα — powered by Stripe</div>
        <div id="payment-element"></div>
        <div id="stripe-error"></div>
        <button id="stripe-pay-btn" type="button">
          <span class="btn-text" data-gr="Πλήρωσε €12 →" data-en="Pay €12 →">Πλήρωσε €12 →</span>
          <span class="btn-spinner"></span>
        </button>
      </div>

      <!-- Shown after successful payment + booking submission -->
      <div class="booking-success" id="bookingSuccess">
        <h3 data-gr="✓ Κράτηση & Πληρωμή Επιβεβαιώθηκαν!" data-en="✓ Booking & Payment Confirmed!">✓ Κράτηση & Πληρωμή Επιβεβαιώθηκαν!</h3>
        <p data-gr="Η κράτησή σου καταχωρήθηκε και η προκαταβολή πληρώθηκε. Θα επικοινωνήσουμε σύντομα." data-en="Your booking is confirmed and the deposit has been paid. We will be in touch shortly.">Η κράτησή σου καταχωρήθηκε και η προκαταβολή πληρώθηκε. Θα επικοινωνήσουμε σύντομα.</p>
      </div>

    </div><!-- /form-wrap -->

    <div class="sidebar">
      <div class="info-card">
        <div class="info-card-title" data-gr="Ωράριο Λειτουργίας" data-en="Opening Hours">Ωράριο Λειτουργίας</div>
        <div class="info-row"><span class="info-icon">◷</span><span data-gr="Δευτέρα – Σάββατο: 11:00–21:00" data-en="Monday – Saturday: 11:00–21:00">Δευτέρα – Σάββατο: 11:00–21:00</span></div>
        <div class="info-row"><span class="info-icon">◷</span><span data-gr="Κυριακή: Κλειστά" data-en="Sunday: Closed">Κυριακή: Κλειστά</span></div>
      </div>
      <div class="info-card">
        <div class="info-card-title" data-gr="Σημαντικές Πληροφορίες" data-en="Important Info">Σημαντικές Πληροφορίες</div>
        <div class="info-row"><span class="info-icon" style="color:var(--gold);">▸</span><span data-gr="Απαιτείται προκαταβολή 30%" data-en="30% deposit required">Απαιτείται προκαταβολή 30%</span></div>
        <div class="info-row"><span class="info-icon" style="color:var(--gold);">▸</span><span data-gr="Piercing: προκαταβολή €12 online" data-en="Piercing: €12 deposit online">Piercing: προκαταβολή €12 online</span></div>
        <div class="info-row"><span class="info-icon" style="color:var(--gold);">▸</span><span data-gr="Ελάχιστη ηλικία: 18 ετών" data-en="Minimum age: 18 years">Ελάχιστη ηλικία: 18 ετών</span></div>
        <div class="info-row"><span class="info-icon" style="color:var(--gold);">▸</span><span data-gr="Φέρε έγκυρη ταυτότητα" data-en="Bring valid ID">Φέρε έγκυρη ταυτότητα</span></div>
        <div class="info-row"><span class="info-icon" style="color:var(--gold);">▸</span><span data-gr="Απάντηση εντός 24 ωρών" data-en="Response within 24 hours">Απάντηση εντός 24 ωρών</span></div>
        <div class="info-row"><span class="info-icon" style="color:var(--gold);">▸</span><span data-gr="Ελεύθερη δωρεάν εκτίμηση" data-en="Free consultation available">Ελεύθερη δωρεάν εκτίμηση</span></div>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="footer-grid">
      <div>
        <div class="footer-logo-row">
          <a href="index.html" class="footer-logo-link">
            <img src="nr40-logo.png" alt="NR40 Urban Arts" class="footer-logo-img">
          </a>
          <p class="footer-desc" data-gr="Τέχνη που μένει για πάντα." data-en="Art that lasts forever.">Τέχνη που μένει για πάντα.</p>
        </div>
        <div class="footer-social">
          <div class="footer-col-title" style="margin-bottom:12px;" data-gr="Ακολούθησέ μας" data-en="Follow Us">Ακολούθησέ μας</div>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <a href="https://www.instagram.com/nr40urban_ath/" target="_blank" rel="noopener" class="footer-ig-link">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" stroke="none"/></svg>
              <span>@nr40urban_ath</span>
            </a>
            <a href="https://www.instagram.com/nr40_ath/" target="_blank" rel="noopener" class="footer-ig-link">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" stroke="none"/></svg>
              <span>@nr40_ath</span>
            </a>
          </div>
        </div>
      </div>
      <div>
        <div class="footer-col-title" data-gr="Σελίδες" data-en="Pages">Σελίδες</div>
        <ul class="footer-links">
          <li><a href="index.html" data-gr="Αρχική" data-en="Home">Αρχική</a></li>
          <li><a href="team.html" data-gr="Καλλιτέχνες" data-en="Artists">Καλλιτέχνες</a></li>
          <li><a href="booking.html" data-gr="Κράτηση" data-en="Booking">Κράτηση</a></li>
          <li><a href="contact.html" data-gr="Επικοινωνία" data-en="Contact">Επικοινωνία</a></li>
        </ul>
      </div>
      <div>
        <div class="footer-col-title" data-gr="Επικοινωνία" data-en="Contact">Επικοινωνία</div>
        <ul class="footer-links">
          <li><a href="tel:+302103806408">+30 210 380 6408</a></li>
          <li><a href="mailto:info@nr40athens.com">info@nr40athens.com</a></li>
          <li><span data-gr="Κανιγγός 27, Αθήνα 106 82" data-en="Kaniggos 27, Athens 106 82">Κανιγγός 27, Αθήνα 106 82</span></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <span>© 2026 NR40. <span data-gr="Όλα τα δικαιώματα διατηρούνται." data-en="All rights reserved.">Όλα τα δικαιώματα διατηρούνται.</span></span>
      <span data-gr="Κανιγγός 27, Αθήνα 106 82" data-en="Kaniggos 27, Athens 106 82">Κανιγγός 27, Αθήνα 106 82</span>
    </div>
  </div>
</footer>

<script src="js/main.js"></script>
<script>
  // ══════════════════════════════════════════════
  // STRIPE — swap this one key when ready
  // Get from: https://dashboard.stripe.com/apikeys
  // Use the PUBLISHABLE key (pk_live_... or pk_test_...)
  // ══════════════════════════════════════════════
  const STRIPE_PUBLISHABLE_KEY = 'pk_test_YOUR_PUBLISHABLE_KEY';

  let stripe = null;
  let stripeElements = null;
  let savedFormData = null; // holds form data while user pays

  let selectedFiles = [];
  let isPiercing = false;

  // ─── PHONE ───
  const phoneInput = document.getElementById('phone');
  phoneInput.addEventListener('input', function() {
    const pos = this.selectionStart;
    let v = this.value.replace(/[^\d+]/g, '');
    v = v.charAt(0) + v.slice(1).replace(/\+/g, '');
    this.value = v;
    try { this.setSelectionRange(pos, pos); } catch(e) {}
    const digits = v.replace('+','');
    this.classList.toggle('invalid', v.length > 0 && digits.length < 7);
    this.classList.toggle('valid', digits.length >= 7);
  });

  // ─── EMAIL ───
  const emailInput = document.getElementById('email');
  const isValidEmail = v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
  emailInput.addEventListener('blur', function() {
    if (!this.value) return;
    this.classList.toggle('invalid', !isValidEmail(this.value));
    this.classList.toggle('valid', isValidEmail(this.value));
  });
  emailInput.addEventListener('input', function() {
    this.classList.remove('invalid');
    this.classList.toggle('valid', isValidEmail(this.value));
  });

  // ─── PIERCING LOGIC ───
  const serviceSelect = document.getElementById('service');
  const artistSelect  = document.getElementById('artist');
  const piercingEls   = document.querySelectorAll('.piercing-only');
  const allArtists    = Array.from(artistSelect.options).map(o => o.cloneNode(true));

  serviceSelect.addEventListener('change', function() {
    isPiercing = this.value === 'Piercing';
    piercingEls.forEach(el => el.classList.toggle('visible', isPiercing));

    if (isPiercing) {
      // Lock artist to Storm only
      artistSelect.innerHTML = '';
      const def = new Option(lang === 'en' ? 'Piercing Artist' : 'Καλλιτέχνης Piercing', '', true, false);
      def.disabled = true;
      artistSelect.appendChild(def);
      const storm = new Option('Storm', 'Storm', false, true);
      artistSelect.appendChild(storm);
      document.getElementById('piercingType').required = true;

      // Update submit button label
      document.querySelector('#submitBtn .btn-text').setAttribute('data-gr', 'Υποβολή & Πληρωμή');
      document.querySelector('#submitBtn .btn-text').setAttribute('data-en', 'Submit & Pay');
    } else {
      // Restore all artists
      artistSelect.innerHTML = '';
      allArtists.forEach(o => artistSelect.appendChild(o.cloneNode(true)));
      document.getElementById('piercingType').required = false;

      document.querySelector('#submitBtn .btn-text').setAttribute('data-gr', 'Αποστολή');
      document.querySelector('#submitBtn .btn-text').setAttribute('data-en', 'Send Request');
    }
    applyLang();
  });

  // ─── FILES ───
  document.getElementById('fileInput').addEventListener('change', function() {
    Array.from(this.files).forEach(f => { if (selectedFiles.length < 5) selectedFiles.push(f); });
    renderFiles(); this.value = '';
  });
  function renderFiles() {
    const list = document.getElementById('fileList'); list.innerHTML = '';
    selectedFiles.forEach((f,i) => {
      const c = document.createElement('div'); c.className = 'file-chip';
      c.innerHTML = `<span>${f.name} <span style="color:var(--gray);font-size:0.8em;">(${(f.size/1024).toFixed(0)}kb)</span></span><button type="button" onclick="removeFile(${i})">✕</button>`;
      list.appendChild(c);
    });
  }
  function removeFile(i) { selectedFiles.splice(i,1); renderFiles(); }

  // ─── BUILD FormData ───
  function buildFormData(paymentIntentId = null) {
    const fd = new FormData();
    fd.append('fullName', document.getElementById('fullName').value.trim());
    fd.append('phone', phoneInput.value.trim());
    fd.append('email', emailInput.value.trim());
    fd.append('artist', artistSelect.value);
    fd.append('service', serviceSelect.value);
    fd.append('message', document.getElementById('message').value.trim());
    if (isPiercing) {
      fd.append('piercingType', document.getElementById('piercingType').value);
      fd.append('depositAmount', '12');
      if (paymentIntentId) fd.append('paymentIntentId', paymentIntentId);
    }
    selectedFiles.forEach(f => fd.append('attachments', f));
    return fd;
  }

  // ─── SUBMIT HANDLER ───
  document.getElementById('bookingForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    // Validate phone
    const phoneDigits = phoneInput.value.replace('+','');
    if (phoneDigits.length < 7) {
      phoneInput.classList.add('invalid');
      return showAlert('formAlert','error','✕ Εισάγετε έγκυρο αριθμό τηλεφώνου.','✕ Please enter a valid phone number.');
    }
    // Validate email
    if (!isValidEmail(emailInput.value.trim())) {
      emailInput.classList.add('invalid');
      return showAlert('formAlert','error','✕ Εισάγετε έγκυρη διεύθυνση email.','✕ Please enter a valid email address.');
    }
    // Validate piercing type
    if (isPiercing && !document.getElementById('piercingType').value) {
      return showAlert('formAlert','error','✕ Παρακαλώ επέλεξε τύπο piercing.','✕ Please select a piercing type.');
    }

    const btn = document.getElementById('submitBtn');

    if (isPiercing) {
      // ── Piercing flow: create PaymentIntent → show Stripe Element ──
      btn.classList.add('loading'); btn.disabled = true;

      try {
        // Call backend to create a PaymentIntent for €12
        const data = await apiPost('/api/payment/create-intent', { amount: 1200, currency: 'eur' });

        if (!data.clientSecret) throw new Error('No client secret returned');

        // Init Stripe once
        if (!stripe) stripe = Stripe(STRIPE_PUBLISHABLE_KEY);

        // Mount Payment Element
        stripeElements = stripe.elements({
          clientSecret: data.clientSecret,
          appearance: {
            theme: 'night',
            variables: {
              colorPrimary: '#c9a84c',
              colorBackground: '#141414',
              colorText: '#f0ece4',
              colorDanger: '#c0392b',
              fontFamily: 'Space Mono, monospace',
              spacingUnit: '4px',
              borderRadius: '0px',
            }
          }
        });

        const paymentElement = stripeElements.create('payment', {
          layout: 'tabs'
        });
        paymentElement.mount('#payment-element');

        // Show payment section
        document.getElementById('stripePaymentSection').classList.add('visible');
        document.getElementById('stripePaymentSection').scrollIntoView({ behavior: 'smooth', block: 'center' });
        applyLang();

        // Hide form submit button (user now uses pay button)
        btn.style.display = 'none';

      } catch(err) {
        showAlert('formAlert','error','✕ Σφάλμα σύνδεσης. Δοκίμασε ξανά.','✕ Connection error. Please try again.');
      } finally {
        btn.classList.remove('loading'); btn.disabled = false;
      }

    } else {
      // ── Normal tattoo booking (no payment) ──
      btn.classList.add('loading'); btn.disabled = true;
      try {
        const fd = buildFormData();
        await apiPostForm('/api/booking', fd);
        showAlert('formAlert','success',
          '✓ Η κράτησή σου ελήφθη! Θα επικοινωνήσουμε εντός 24 ωρών.',
          '✓ Booking received! We will contact you within 24 hours.'
        );
        resetForm();
      } catch(err) {
        showAlert('formAlert','error','✕ Σφάλμα αποστολής. Δοκίμασε ξανά.','✕ Submission failed. Please try again.');
      } finally {
        btn.classList.remove('loading'); btn.disabled = false;
      }
    }
  });

  // ─── STRIPE PAY BUTTON ───
  document.getElementById('stripe-pay-btn').addEventListener('click', async function() {
    const errEl = document.getElementById('stripe-error');
    errEl.textContent = '';
    this.classList.add('loading'); this.disabled = true;

    try {
      // Confirm payment (no redirect — stays on page)
      const { error, paymentIntent } = await stripe.confirmPayment({
        elements: stripeElements,
        confirmParams: {
          return_url: window.location.href, // fallback only for 3DS
        },
        redirect: 'if_required',
      });

      if (error) {
        errEl.textContent = error.message;
        this.classList.remove('loading'); this.disabled = false;
        return;
      }

      if (paymentIntent && paymentIntent.status === 'succeeded') {
        // Payment succeeded — now submit booking to backend
        const fd = buildFormData(paymentIntent.id);
        await apiPostForm('/api/booking', fd);

        // Show success, hide payment section and form
        document.getElementById('stripePaymentSection').classList.remove('visible');
        document.getElementById('bookingSuccess').classList.add('visible');
        document.getElementById('bookingSuccess').scrollIntoView({ behavior: 'smooth', block: 'center' });
        applyLang();
        resetForm();
      }

    } catch(err) {
      errEl.textContent = lang === 'en' ? 'Payment failed. Please try again.' : 'Αποτυχία πληρωμής. Δοκίμασε ξανά.';
      this.classList.remove('loading'); this.disabled = false;
    }
  });

  // ─── RESET ───
  function resetForm() {
    document.getElementById('bookingForm').reset();
    selectedFiles = []; renderFiles();
    isPiercing = false;
    piercingEls.forEach(el => el.classList.remove('visible'));
    artistSelect.innerHTML = ''; allArtists.forEach(o => artistSelect.appendChild(o.cloneNode(true)));
    phoneInput.classList.remove('valid','invalid');
    emailInput.classList.remove('valid','invalid');
    document.getElementById('submitBtn').style.display = '';
    // Reset submit label
    document.querySelector('#submitBtn .btn-text').setAttribute('data-gr', 'Αποστολή');
    document.querySelector('#submitBtn .btn-text').setAttribute('data-en', 'Send Request');
    applyLang();
  }
</script>
<script>window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };</script>
<script defer src="/_vercel/speed-insights/script.js"></script>
</body>
</html>